#!/bin/bash
# ============================================
# CONFIGURACIÓN DE DEPLOYMENT - AMBIENTE MHW (GCP)
# Archivo actualizado automáticamente por Gemini
# ============================================

# ============================================
# PROYECTO GCP
# ============================================
export GCP_PROJECT_ID="ticket-home-demo"
export GCP_REGION="us-central1"
export GCP_ZONE="us-central1-c" # Asumido desde la instancia de Cloud SQL

# ============================================
# APLICACIÓN
# ============================================
export APP_NAME="ticket-home"
export SERVICE_NAME="tickethome-demo"
export ENVIRONMENT="mhw"

# ============================================
# DOMINIO Y DNS
# ============================================
export DOMAIN_NAME="ticket-home-beta.mhwdev.dev" # Valor por defecto del README
export RESERVED_IP_NAME="${SERVICE_NAME}-ip"

# ============================================
# CLOUD SQL (INSTANCIA EXISTENTE)
# ============================================
export CLOUDSQL_INSTANCE_NAME="tickethome-db"
export CLOUDSQL_INSTANCE_CONNECTION_NAME="ticket-home-demo:us-central1:tickethome-db"
export CLOUDSQL_PUBLIC_IP="34.60.42.106"
export CLOUDSQL_PORT="5432"

# NUEVA BASE DE DATOS A CREAR
export DB_NAME="mhw_ticket_home"
export DB_USER="mhw_user"
export DB_PASSWORD="" # ⚠️ DEBES COMPLETAR ESTA CONTRASEÑA

# URL DE CONEXIÓN (se construye automáticamente)
export DATABASE_URL="postgresql://${DB_USER}:${DB_PASSWORD}@${CLOUDSQL_PUBLIC_IP}:${CLOUDSQL_PORT}/${DB_NAME}"

# ============================================
# DOCKER & ARTIFACT REGISTRY
# ============================================
export ARTIFACT_REGISTRY_REGION="us-central1"
export ARTIFACT_REGISTRY_REPO="tickethome-repo"
export IMAGE_NAME="${ARTIFACT_REGISTRY_REGION}-docker.pkg.dev/${GCP_PROJECT_ID}/${ARTIFACT_REGISTRY_REPO}/${APP_NAME}"
export IMAGE_TAG="latest"

# ============================================
# SECRETS EN SECRET MANAGER
# ============================================
export SECRET_DATABASE_URL_NAME="mhw-database-url"
export SECRET_KEY_NAME="mhw-secret-key"
export SECRET_SUPERUSER_EMAILS_NAME="mhw-superuser-emails"

# Valores de los secrets (⚠️ COMPLETAR SI ES NECESARIO)
export SECRET_KEY="" # ⚠️ Generar con: python -c "import secrets; print(secrets.token_hex(32))"
export SUPERUSER_EMAILS="jonathan.segura@redsalud.cl;jonathan.segura.vega@gmail.com" # Asumido del README

# ============================================
# OAUTH 2.0 (IAP)
# ============================================
export OAUTH_CLIENT_ID=""      # ⚠️ Completar después de crear OAuth Client
export OAUTH_CLIENT_SECRET=""  # ⚠️ Completar después de crear OAuth Client

# ============================================
# SERVICE ACCOUNT
# ============================================
export SERVICE_ACCOUNT_NAME="tickethome-demo-sa"
export SERVICE_ACCOUNT_EMAIL="tickethome-demo-sa@ticket-home-demo.iam.gserviceaccount.com"

# ============================================
# LOAD BALANCER - COMPONENTES
# ============================================
export NEG_NAME="${SERVICE_NAME}-neg"
export BACKEND_SERVICE_NAME="${SERVICE_NAME}-backend"
export URL_MAP_NAME="${SERVICE_NAME}-url-map"
export SSL_CERT_NAME="${SERVICE_NAME}-ssl"
export HTTPS_PROXY_NAME="${SERVICE_NAME}-https-proxy"
export FORWARDING_RULE_NAME="${SERVICE_NAME}-forwarding-rule"

# (El resto del archivo contiene funciones y no necesita cambios)